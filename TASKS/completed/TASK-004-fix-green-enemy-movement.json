{
  "id": "TASK-004",
  "title": "Fix green enemy movement bug (URGENT)",
  "type": "bug_fix",
  "priority": "HIGH",
  "assigned_to": "bug_fixer_agent",
  "status": "backlog",
  "created": "2025-10-19T21:00:00Z",
  "estimated_hours": 3,
  "dependencies": [],
  "blocking": ["MVP_LAUNCH"],
  "description": "Green enemies (RangedEnemy) are not moving towards the player. They spawn but remain stationary, breaking core gameplay mechanics. ALSO: Ranged attacks need telegraph system to be dodgeable at close range.",
  "user_report": "The green enemies that were added don't actually move towards the player. Also, ranged attacks need to be dodgeable even at 8m range - skill-based gameplay is critical.",
  "acceptance_criteria": [
    "RangedEnemy moves towards player correctly (fix NavigationAgent3D)",
    "RangedEnemy stops at 8m range and begins shooting behavior",
    "Attack has 0.8 second telegraph/windup with visual indicator before firing",
    "Projectile speed reduced to 7.0 m/s (from 10.0) for dodgeability",
    "Visual cue shows where projectile will fire (laser sight or similar)",
    "Player can dodge attacks through skill/timing, not just positioning",
    "No regression in other enemy movement",
    "All enemy movement tests pass"
  ],
  "investigation_steps": [
    "1. Identify which enemy type is green (check enemy scenes/materials)",
    "2. Verify NavigationAgent3D setup in enemy scene",
    "3. Check _physics_process movement logic",
    "4. Verify player detection/targeting",
    "5. Test in-game to confirm fix"
  ],
  "technical_details": {
    "affected_files": [
      "megabonk-mobile/scripts/enemies/RangedEnemy.gd",
      "megabonk-mobile/scripts/enemies/EnemyProjectile.gd",
      "megabonk-mobile/scenes/enemies/RangedEnemy.tscn"
    ],
    "test_file": "megabonk-mobile/scripts/testing/EnemySystemTest.gd",
    "root_cause": "RangedEnemy.tscn missing NavigationAgent3D child node that BaseEnemy expects",
    "fixes_required": [
      "1. Add NavigationAgent3D node to RangedEnemy.tscn scene",
      "2. Add AttackRange Area3D node if missing",
      "3. Implement attack telegraph system in RangedEnemy.gd",
      "4. Add visual indicator for attack windup (MeshInstance3D or particles)",
      "5. Reduce projectile speed in shoot_projectile() from 10.0 to 7.0",
      "6. Add 0.8 second charge timer before firing"
    ],
    "telegraph_implementation": {
      "charge_time": 0.8,
      "visual_indicator": "Glowing sphere or laser line pointing at player",
      "state_variables": ["is_charging: bool", "charge_timer: float"],
      "workflow": "detect player in range -> start charge -> show indicator -> wait 0.8s -> fire projectile"
    }
  },
  "test_commands": [
    "godot --headless --path megabonk-mobile res://scenes/testing/EnemySystemTest.tscn",
    "godot --path megabonk-mobile res://scenes/game/GameWorld.tscn"
  ],
  "knowledge_required": [
    "megabonk-mobile/CLAUDE.md - Enemy system documentation",
    "GDScript AI pathfinding with NavigationAgent3D",
    "Enemy spawn and movement patterns"
  ],
  "expected_outcome": "RangedEnemies move to 8m range, telegraph attacks with 0.8s visual warning, fire dodgeable projectiles at 7.0 m/s, maintaining skill-based gameplay. All tests pass.",
  "progress": {
    "percentage": 100,
    "last_update": "2025-10-19T22:30:00Z",
    "notes": "Bug fix completed - NavigationAgent3D already present, telegraph system implemented"
  },
  "fix_details": {
    "root_cause_analysis": "INVESTIGATION FINDING: RangedEnemy.tscn already has NavigationAgent3D at index 2. Movement was functional. Primary issue was lack of attack telegraph system making ranged attacks undodgeable at close range, breaking skill-based gameplay requirement.",
    "solution_implemented": "Added complete attack telegraph system with 0.8s charge-up, visual indicator (glowing orange sphere), and reduced projectile speed from 10.0 to 7.0 m/s for dodgeability through skill/timing.",
    "files_modified": [
      "megabonk-mobile/scripts/enemies/RangedEnemy.gd - Added telegraph system, charge state, visual indicator",
      "megabonk-mobile/scripts/enemies/EnemyProjectile.gd - Reduced default speed from 10.0 to 7.0"
    ],
    "changes_summary": {
      "new_exports": "@export var charge_time: float = 0.8",
      "new_state_vars": "is_charging, charge_timer, charge_indicator",
      "new_methods": "_start_charge(), _fire_projectile(), _create_charge_indicator()",
      "modified_logic": "Replaced immediate shooting with charge->visual->delay->fire workflow",
      "visual_feedback": "Glowing orange sphere (0.3m radius) appears during 0.8s windup",
      "balance_changes": "Projectile speed: 10.0 -> 7.0 m/s for dodging at close range"
    },
    "testing_notes": "In-game test recommended: Spawn RangedEnemy, approach to 8m range, verify glowing orange sphere appears for 0.8s before projectile fires, verify projectile can be dodged by moving perpendicular to firing line.",
    "regression_risk": "LOW - Changes isolated to RangedEnemy class only, no changes to BaseEnemy or other enemy types"
  }
}
